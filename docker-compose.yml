version: "3.9"
services:
  tests:
    image: python:3.8-slim-buster
    working_dir: /app
    volumes:
      - ./app.py:/app/app.py
      - ./requirements.txt:/app/requirements.txt
    command: bash -c "pip install -r requirements.txt && pytest -s app.py"
  code_climate:
    image: python:3.8-slim-buster
    working_dir: /app
    environment:
      - CC_TEST_REPORTER_ID=$CC_TEST_REPORTER_ID
    volumes:
      - .git:/app/.git
      - ./app.py:/app/app.py
      - ./requirements.txt:/app/requirements.txt      
      - ./code_climate.sh:/app/code_climate.sh
    # command: tail -f /dev/null
    command: bash code_climate.sh  